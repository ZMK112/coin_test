# CoinKlineDemo

### 项目基本说明：

- 兼容获取binance，okx历史及实时分钟数据，支持多symbols，frequency
  1. 核心代码  src/exchanges下，根据交易所具体情况分拆py

- 支持代理池及访问频率控制
  1. 代理池模块考虑到项目仅为测试留空（基本思路为proxy server，该项目中仅增加proxy client）
  2. 考虑到历史数据及官方频率限制增加设置切分，受到这种可能影响，所以使用httpx而不是aiohttp，不保持session，简化项目；
  3. 代理可不设置，则正常使用；相关配置未简化项目，因此直接根据交易所及测试情况硬编码；
- 支持原始数据存储及过滤字段两种需求
  1. tasks/data_collection.py下初始化对象设置filter_columns参数（ps：一般不动原始数据，保留所有字段）
- 支持client端传参查询
  1. 主要代码 tasks/query_database_task.py 
  2. 说明：为简化代码并没有分离查询及数据库操作用户（权限分离），参数及接口已预留；未防止基本的注入可能的安全问题，仅做简单的参数转义处理；
  3. 为简化代码，数据插入及输出均为压缩或者record格式，而是dataframe，数据量很小性能开销忽略；
- 支持 cython 定义candle结构体，减少接收数据结构化开销（ps：分钟数据量较小，意义不大，实际并未使用，预留兼容order 等深度行情处理，有些提升）
- 为简化项目未做自定义symbol模块
- 考虑到sqllit性能及实际使用与开发便利，项目使用clickhouse数据库；
  - 分钟数据量较小，考虑到clickhouse一些主键与merge bug，性能要求不高，可能mysql8会方便点

### 项目框架

- 考虑到历史及实时两种需求叠加及简化项目，所以使用当前方式；
- 比较合理的方式：实时采用订阅式框架（connection，datafeed及handler模块，兼容ws与rest）

### 优化建议

- **该项目仅可临时使用**
- 可优化部分
  1. Pydantic 配置项目更规范及灵活一点，避免明文过多
  2. 实时及历史数据模块分离
  3. clickhouse数据输入输出可压缩或者其他格式优化，减少开销
  4. exchanges中硬编码的部分比较多，部分公有设置可以抽象，部分个性化处理还是保留，交易所也存在变动过度抽象不便修改
  5. 数据时间实际统一使用的式毫秒，原始数据可以保留，最好采用纳秒并统一处理
  6. 增加自定义symbol模块，不同交易所symbol统一
- 代码部分：
  1. 为简化代码，部分import *，若引入过多换枚举
  2. import 规范为使用isort工具处理，按照使用习惯将三方包，内部引用分组排列，方便查bug；若项目十分庞大可isort规范处理；
  3. exchanges 硬编码的部分即便抽象出公有及通用参数后，还是会剩很多硬编码的部分，暂时为找到合理解决方案，一些开源项目涉及多交易所data 硬编码部分仍然很多，因此不同exchange独立py



